<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>Create Player Account</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    :root{
      --bg:#0b0b0b; --card:#111; --soft:#1a1a1a; --accent:#f5c542; --text:#fff; --muted:#aeb4c2; --hdr:64px;
    }
    html,body{height:100%}
    body{
      margin:0; padding:0; background:var(--bg); color:var(--text);
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;
      min-height:100%;
      display:flex; flex-direction:column; align-items:stretch; justify-content:flex-start;
      /* Safe-area + brand header offset so nothing hides behind the notch */
      padding-top: calc(var(--hdr) + env(safe-area-inset-top));
    }

    /* Sticky brand header */
    .brand-bar{
      position:fixed; inset:0 0 auto 0; height:var(--hdr);
      display:flex; align-items:center; gap:.6rem;
      padding: calc(env(safe-area-inset-top) + 8px) 14px 8px;
      background:linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.35) 70%, rgba(0,0,0,0));
      backdrop-filter:saturate(120%) blur(6px);
      border-bottom:1px solid #1b1b1b;
      z-index:1000;
    }
    .brand-bar a.brand{ display:inline-flex; align-items:center; gap:.55rem; color:#fff; text-decoration:none; font-weight:700; letter-spacing:.2px; }
    .brand-bar img{ height:34px; width:auto; display:block; }
    .brand-bar .brand span{ color:#fff; font-size:1rem; }

    /* Card spacing now that header is fixed */
    .page-wrap{ width:100%; flex:1 0 auto; }

    .auth-card{
      width:92%; max-width:420px; background:var(--card);
      padding:2rem; border-radius:16px; box-shadow:0 8px 28px rgba(0,0,0,.45);
      border:1px solid var(--soft); text-align:left;
      margin: 1.25rem auto 3rem;
    }
    .auth-card h1{ margin:0 0 .25rem; font-size:1.6rem; color:var(--accent); text-align:center; }
    .auth-card > p{ margin:.25rem 0 1.25rem; color:var(--muted); text-align:center; }

    form{ display:grid; gap:1rem; }
    label{ font-weight:600; color:#e6e6e6; font-size:.95rem; }

    input[type="text"], input[type="password"]{
      width:100%; padding:.8rem .9rem; border-radius:10px; border:1px solid #2b2b2b;
      background:#000; color:var(--text); font-size:1rem; outline:none;
      transition:border-color .2s, box-shadow .2s;
    }
    input[type="text"]:focus, input[type="password"]:focus{
      border-color:#323232; box-shadow:0 0 0 3px rgba(245,197,66,.2);
    }

    small{ color:#bdbdbd; line-height:1.35; }
    label.consent{ display:flex; gap:.6rem; align-items:flex-start; font-size:.9rem; color:#d8d8d8; }
    label.consent input{ margin-top:.15rem; }

    button[type="submit"]{
      background:var(--accent); color:#000; font-weight:700; letter-spacing:.2px;
      border:0; padding:.9rem 1rem; border-radius:12px; cursor:pointer; font-size:1rem;
      transition:transform .04s ease, background .25s ease;
    }
    button[type="submit"]:hover{ background:#e6b938; }
    button[type="submit"]:active{ transform:translateY(1px); }

    .error{ display:none; color:#ff6b6b; font-size:.92rem; margin-top:-.25rem; }
    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }
    .auth-card > p:last-child{ text-align:center; color:var(--muted); }

    /* Mobile tuning */
    @media (max-width: 480px){
      .brand-bar{ height:56px; }
      .auth-card{ padding:1.25rem; margin: .75rem auto 2rem; }
      .auth-card h1{ font-size:1.4rem; }
      input{ font-size:.98rem; }
    }
  </style>
</head>
<body>
  <header class="brand-bar">
    <a class="brand" href="/" aria-label="Foundry Soccer Academy home">
      <img src="/images/logo.png" alt="Foundry logo" />
      <span>Foundry Soccer Academy</span>
    </a>
  </header>

  <div class="page-wrap">
    <main class="auth-card">
      <h1>Create account</h1>
      <p>Players sign in with username + password. No email/phone required.</p>

      <form id="signupForm">
        <label>Username
          <input id="su" name="username" type="text" minlength="3" maxlength="24" pattern="[A-Za-z0-9_]+" title="3–24 characters: letters, numbers, underscore only" autocomplete="username" required autofocus />
        </label>

        <label>Password
          <input id="sp" name="password" type="password" minlength="8" autocomplete="new-password" required
                 pattern="(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[!@#$%^&*]).{8,}"
                 title="Password must be at least 8 characters and include one uppercase letter, one lowercase letter, one number, and one special symbol." />
        </label>
        
        <label>Confirm password
          <input id="sp2" name="passwordConfirm" type="password" minlength="8" autocomplete="new-password" title="Re-enter the same password" required />
        </label>
        
        <small style="color:#bbb;display:block;margin-top:-.5rem;margin-bottom:1rem;">
          Must be at least 8 characters and include 1 uppercase letter, 1 lowercase letter, 1 number, and 1 special symbol.
        </small>
        
        <label style="display:flex;align-items:center;gap:.5rem;font-size:.9rem">
          <input id="showpw" type="checkbox" />
          <span>Show password</span>
        </label>

        <label>First name
          <input id="sf" name="firstName" type="text" maxlength="30" autocomplete="given-name" required
                 pattern="[A-Za-z ]+"
                 oninput="this.value=this.value.replace(/[^A-Za-z ]/g,'')"
          />
        </label>

        <label>Last initial
          <input id="sl" name="lastInitial" type="text" maxlength="1" title="One letter A–Z" required
                 pattern="[A-Za-z]"
                 oninput="this.value = this.value.replace(/[^A-Za-z]/g,'').toUpperCase().slice(0,1)"
          />
        </label>

        <label class="consent">
          <input id="consent" name="consent" type="checkbox" required />
          <span>Parent/guardian confirms account creation for a minor and agrees to program terms.</span>
        </label>

        <button type="submit">Create Account</button>
        <div id="serr" class="error" role="alert" aria-live="polite"></div>
      </form>

      <p style="margin-top:.75rem;">Already have an account? <a href="/login.html">Sign in</a></p>
    </main>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('signupForm');
    const serr = document.getElementById('serr');
    const show = document.getElementById('showpw');
    const p1 = document.getElementById('sp');
    const p2 = document.getElementById('sp2');

    // wire show/hide once
    if (show && p1 && p2) {
      show.addEventListener('change', () => {
        const t = show.checked ? 'text' : 'password';
        p1.type = t; p2.type = t;
      });
    }

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      serr.style.display = 'none';
      serr.textContent = '';
      serr.setAttribute('role','alert');
      serr.setAttribute('aria-live','polite');

      // basic client checks
      const username = document.getElementById('su').value.trim();
      const password = p1.value;
      const passwordConfirm = p2.value;
      const firstName = document.getElementById('sf').value.trim();
      const lastInitial = document.getElementById('sl').value.trim();
      const consent = document.getElementById('consent').checked;

      if (!consent) {
        serr.textContent = 'Consent required';
        serr.style.display = 'block';
        return;
      }
      if (password !== passwordConfirm) {
        serr.textContent = 'Passwords do not match';
        serr.style.display = 'block';
        return;
      }

      const btn = form.querySelector('button[type="submit"]');
      btn && (btn.disabled = true);

      try {
        const r = await fetch('/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password, passwordConfirm, firstName, lastInitial })
        });

        const data = await r.json().catch(() => ({}));
        if (!r.ok || !data.ok) {
          throw new Error(data.error || 'Signup failed');
        }

        // success -> go to login
        window.location.href = '/login.html';
      } catch (err) {
        let msg = err && err.message ? err.message : 'Signup failed';
        try {
          const resp = await fetch('/api/signup', { method: 'POST' });
        } catch {}
        // If the previous fetch threw, we already have msg. But try to surface any server detail from last response if we captured it above
        serr.textContent = msg;
        serr.style.display = 'block';
        serr.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } finally {
        btn && (btn.disabled = false);
      }
    });
  });
  </script>
</body>
</html>